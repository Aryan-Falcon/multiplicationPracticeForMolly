<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Arcane Tower</title>

<style>
body{
    margin:0;
    font-family:"Georgia",serif;
    background:radial-gradient(circle at top,#3a0057,#120018);
    color:#f8e7ff;
    text-align:center;
}

h1{
    font-size:48px;
    margin:20px 0;
    text-shadow:0 0 20px #ff6cff;
}

#battlefield{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 100px;
}

.entity{
    width:260px;
    height:260px;
    background-size:contain;
    background-repeat:no-repeat;
    background-position:center;
}

#hero{
    background-image:url("https://i.pinimg.com/474x/c0/6e/e4/c06ee4f5b2cecf7f6576343fdf521df1.jpg");
}

.hp-container{
    width:320px;
    margin:0 auto 10px;
}

.hp-bar{
    height:18px;
    background:#3a003a;
    border-radius:12px;
    overflow:hidden;
}

.hp-fill{
    height:100%;
    background:linear-gradient(to right,#ff6cff,#ff9cff);
}

.hp-text{
    margin-top:6px;
    font-size:16px;
}

#ui{margin-top:10px}

#timer{
    font-size:26px;
    margin-bottom:10px;
}

#question-box{
    font-size:36px;
    margin-bottom:10px;
}

#answer{
    font-size:28px;
    width:180px;
    text-align:center;
    padding:6px;
}

#feedback-box{
    margin-top:12px;
    min-height:40px;
    font-size:22px;
    padding:8px;
    border:2px solid #ff6cff;
    border-radius:10px;
    box-shadow:0 0 15px #ff6cff;
}

/* SPELLS */
.spell{
    position:absolute;
    width:90px;
    height:90px;
    border-radius:50%;
    pointer-events:none;
    z-index:999;
    animation:spellFly .9s cubic-bezier(.4,0,.2,1) forwards;
}

.arcane{background:radial-gradient(circle,#fff,#a020f0);box-shadow:0 0 40px #c070ff}
.fire{background:radial-gradient(circle,#fff,#ff4500);box-shadow:0 0 50px #ff4500}
.grand{background:radial-gradient(circle,#fff,gold);box-shadow:0 0 70px gold}
.dark{background:radial-gradient(circle,#fff,#660000);box-shadow:0 0 60px #880000}

@keyframes spellFly{
    0%{transform:scale(.5);opacity:1}
    70%{transform:scale(1.2) translate(var(--dx),var(--dy))}
    100%{transform:scale(.3) translate(var(--dx),var(--dy));opacity:0}
}

.hit{animation:flash .25s}
@keyframes flash{50%{filter:brightness(2.5)}}

.shake{animation:shake .4s}
@keyframes shake{
    25%{transform:translateX(-8px)}
    50%{transform:translateX(8px)}
    75%{transform:translateX(-8px)}
}
</style>
</head>

<body>

<h1>Arcane Tower</h1>

<div id="battlefield">
    <div>
        <div class="hp-container">
            <div class="hp-bar"><div id="hero-hp" class="hp-fill"></div></div>
            <div class="hp-text" id="hero-hp-text">100 HP</div>
        </div>
        <div id="hero" class="entity"></div>
    </div>

    <div>
        <div class="hp-container">
            <div class="hp-bar"><div id="monster-hp" class="hp-fill"></div></div>
            <div class="hp-text" id="monster-hp-text"></div>
        </div>
        <div id="monster" class="entity"></div>
    </div>
</div>

<div id="ui">
    <div id="timer">⏳ Time: 20</div>
    <div id="question-box"></div>
    <input id="answer" type="number" placeholder="ENTER">
    <div id="feedback-box"></div>
</div>

<script>
const FIXED_TIME=20;
let score=0,attempts=0,streak=0;
let monstersDefeated=0;
let heroHP=100;
let monsterHP=60,maxMonsterHP=60;
let timer,timeLeft,gameOver=false;
let maxDamageCap=40;
let currentQuestion;

const hero=document.getElementById("hero");
const monster=document.getElementById("monster");
const answer=document.getElementById("answer");
const feedback=document.getElementById("feedback-box");

const monsterImages={
1:"https://p1.hiclipart.com/preview/549/267/644/monster-rpg-maker-mv-rpg-maker-vx-game-roleplaying-game-slime-slime-morimori-dragon-quest-video-game-development-png-clipart.jpg",
2:"https://i.pinimg.com/originals/12/74/5e/12745ef0d668ea915bc5cb4a6223e643.jpg",
3:"https://i.pinimg.com/564x/bc/92/9a/bc929acfd5d867c805c06dbe8b05855c.jpg",
4:"https://koboldpress.com/wp-content/uploads/2013/02/ghost_goblin_by_chrismcfann.jpg",
5:"https://i.pinimg.com/474x/c8/51/9c/c8519ce4a412892d327c7671c1f30bc3.jpg",
6:"https://static.wikia.nocookie.net/rpgtalk/images/e/e0/IronGolemDNDB.jpeg",
7:"https://i.pinimg.com/474x/76/47/77/7647777b090a764468351b91061db6f4.jpg",
8:"https://img.freepik.com/free-photo/literary-fantasy-character_23-2151863447.jpg",
9:"https://i.pinimg.com/474x/c8/51/9c/c8519ce4a412892d327c7671c1f30bc3.jpg",
10:"https://img.freepik.com/premium-photo/close-up-monster-with-purple-face-purple-body-generative-ai_974533-21727.jpg",
11:"https://media.zenfs.com/en/gamesradar_237/ecff60b6a6145d271e2ff32da3526946",
12:"https://static.wikia.nocookie.net/fairytailfanon/images/5/52/Leviathan2.jpg",
13:"https://c2.staticflickr.com/6/5611/15565517260_275a4e52fa_b.jpg",
14:"https://files.d20.io/images/424476265/3P9xMAY1XiVamu9HW3-j2g/original.png",
15:"/mnt/data/A_screenshot_of_an_educational_RPG_game_titled_\"Ar.png"
};

function spawnSpell(type){
    const s=document.createElement("div");
    s.className="spell "+type;
    document.body.appendChild(s);
    const h=hero.getBoundingClientRect();
    const m=monster.getBoundingClientRect();
    s.style.left=h.left+h.width/2-45+"px";
    s.style.top=h.top+h.height/2-45+"px";
    s.style.setProperty("--dx",(m.left-h.left)+"px");
    s.style.setProperty("--dy",(m.top-h.top)+"px");
    monster.classList.add("hit");
    setTimeout(()=>monster.classList.remove("hit"),250);
    setTimeout(()=>s.remove(),900);
}

function showQuestion(){
    const a=Math.ceil(Math.random()*12);
    const b=Math.ceil(Math.random()*12);
    const div=Math.random()<0.5;
    currentQuestion={
        text:div?`${a*b} ÷ ${a} = ?`:`${a} × ${b} = ?`,
        answer:div?b:a*b
    };
    document.getElementById("question-box").innerText=currentQuestion.text;
}

function spawnMonster(){
    const idx=monstersDefeated+1;
    maxMonsterHP=60+(idx-1)*18;
    monsterHP=maxMonsterHP;
    monster.style.backgroundImage=`url('${monsterImages[idx]}')`;
    updateMonsterHP();
}

function updateMonsterHP(){
    document.getElementById("monster-hp").style.width=(monsterHP/maxMonsterHP*100)+"%";
    document.getElementById("monster-hp-text").innerText=monsterHP+" HP";
}

function updateHeroHP(){
    document.getElementById("hero-hp").style.width=heroHP+"%";
    document.getElementById("hero-hp-text").innerText=heroHP+" HP";
}

function submitAnswer(){
    if(gameOver)return;
    clearInterval(timer);
    const val=Number(answer.value);
    answer.value="";
    attempts++;

    if(val===currentQuestion.answer){
        streak++;score++;
        feedback.innerText="✔ Correct";
        const dmg=20+Math.min(streak*5,maxDamageCap);
        monsterHP-=dmg;
        spawnSpell(streak>=8?"grand":streak>=5?"fire":"arcane");
        updateMonsterHP();

        if(monsterHP<=0){
            monstersDefeated++;
            if(monstersDefeated===5||monstersDefeated===10)return choiceEvent();
            if(monstersDefeated>=15)return endGame(true);
            spawnMonster();
        }
        next();
    }else{
        streak=0;
        feedback.innerText=`✖ ${currentQuestion.text.replace("= ?","= "+currentQuestion.answer)}`;
        monsterAttack(false);
    }
}

function monsterAttack(timeout){
    spawnSpell("dark");
    heroHP=Math.max(heroHP-(timeout?20:10+monstersDefeated*2),0);
    updateHeroHP();
    hero.classList.add("shake");
    setTimeout(()=>hero.classList.remove("shake"),400);
    heroHP<=0?endGame(false):setTimeout(next,3500);
}

function choiceEvent(){
    feedback.innerHTML=`Choose a reward:<br>
    <button onclick="gainHP()">+10 HP</button>
    <button onclick="gainDamage()">+5 Max Damage</button>`;
}

function gainHP(){
    heroHP=Math.min(heroHP+10,100);
    updateHeroHP();
    feedback.innerText="HP increased!";
    spawnMonster();next();
}

function gainDamage(){
    maxDamageCap+=5;
    feedback.innerText="Damage cap increased!";
    spawnMonster();next();
}

function next(){
    feedback.innerText="";
    showQuestion();
    startTimer();
}

/* FIXED TIMER LOGIC */
function startTimer(){
    clearInterval(timer);
    timeLeft=FIXED_TIME;
    document.getElementById("timer").innerText=`⏳ Time: ${timeLeft}`;

    timer=setInterval(()=>{
        document.getElementById("timer").innerText=`⏳ Time: ${--timeLeft}`;
        if(timeLeft<=0){
            clearInterval(timer);
            feedback.innerText=
                `⌛ Time's up! ${currentQuestion.text.replace("= ?","= "+currentQuestion.answer)}`;
            setTimeout(()=>monsterAttack(true),3500);
        }
    },1000);
}

function endGame(win){
    gameOver=true;
    clearInterval(timer);
    const accuracy=(score/Math.max(attempts,1))*100;
    const rank=
        monstersDefeated>=15?"Grandmaster":
        monstersDefeated>=12?"Archmage":
        monstersDefeated>=9?"Mage":
        monstersDefeated>=7?"Apprentice":"I have no brain yet";

    document.body.innerHTML=`
    <h1>${win?"Victory!":"Defeat"}</h1>
    <p>Monsters Defeated: ${monstersDefeated}</p>
    <p>Accuracy: ${accuracy.toFixed(1)}%</p>
    <p>Rank Achieved: <strong>${rank}</strong></p>
    <button onclick="location.reload()">Play Again</button>`;
}

answer.addEventListener("keydown",e=>e.key==="Enter"&&submitAnswer());

updateHeroHP();
spawnMonster();
showQuestion();
startTimer();
</script>

</body>
</html>
