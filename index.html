<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Multiplication RPG ‚Äî Arcane Tower</title>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Georgia', serif;
        background: radial-gradient(circle at center, #3a0057, #120018);
        color: #f8e7ff;
        overflow-x: hidden;
    }

    h1 {
        text-align: center;
        font-size: 42px;
        margin-top: 20px;
        color: #ffd6ff;
        text-shadow: 0 0 15px #ff6cff;
    }

    /* === RANK PROGRESS BAR (LEFT SIDE) === */
    #rank-panel {
        position: fixed;
        top: 50px;
        left: 20px;
        height: 500px;
        width: 150px;
        display: flex;
        gap: 10px;
        z-index: 200;
    }

    #rank-bar-container {
        width: 20px;
        height: 500px;
        background: #2a0038;
        border: 2px solid #ff9dff;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }

    #rank-fill {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 0%;
        background: linear-gradient(to top, #ff00ff, #ffb7ff);
        transition: height 0.4s ease-out;
    }

    #rank-labels {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 500px;
        font-size: 16px;
        padding-left: 5px;
        text-shadow: 0 0 8px #ff7cff;
    }

    #battlefield {
        margin-top: 40px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        text-align: center;
    }

    .character {
        width: 200px;
        height: 200px;
        background-size: cover;
    }

    #hero {
        background-image: url('https://i.etsystatic.com/49218806/r/il/141e80/6557512067/il_fullxfull.6557512067_asdh.jpg');
    }

    #monster {
        background-image: url('https://p1.hiclipart.com/preview/549/267/644/monster-rpg-maker-mv-rpg-maker-vx-game-roleplaying-game-slime-slime-morimori-dragon-quest-video-game-development-png-clipart.jpg');
        transition: opacity 0.5s, transform 0.5s;
    }

    #hp-bars {
        margin-top: 20px;
        text-align: center;
        font-size: 24px;
    }

    .hp-bar {
        width: 60%;
        height: 25px;
        background: #3a003a;
        border: 2px solid #ffb7ff;
        margin: 10px auto;
    }

    .hp-fill {
        height: 100%;
        background: #ff55ff;
        width: 100%;
        transition: width 0.5s;
    }

    #question-box {
        margin-top: 30px;
        font-size: 32px;
        font-weight: bold;
        text-align: center;
    }

    input {
        margin-top: 15px;
        font-size: 26px;
        padding: 8px;
        width: 150px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
        border-radius: 10px;
        border: none;
    }

    #log {
        font-size: 20px;
        margin-top: 20px;
        min-height: 60px;
        text-align: center;
    }

    #streak-indicator {
        font-size: 22px;
        margin-top: 10px;
        color: #ffd0ff;
        text-align: center;
        text-shadow: 0 0 10px #ff7cff;
        transition: transform 0.2s;
    }

    #results {
        margin-top: 40px;
        font-size: 28px;
        font-weight: bold;
        text-align: center;
    }

    button {
        margin-top: 25px;
        padding: 12px 25px;
        background: #c200ff;
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 26px;
        cursor: pointer;
    }

    button:hover { background: #ff2eff; }

    /* Spell projectile */
    .spell {
        position: absolute;
        width: 40px;
        height: 40px;
        background: radial-gradient(circle, #ff88ff, #c200ff);
        border-radius: 50%;
        box-shadow: 0 0 25px #ff44ff;
        pointer-events: none;
        animation: spellFly 0.5s linear forwards;
    }

    @keyframes spellFly {
        from { transform: scale(0.6); opacity: 1; }
        to { transform: scale(1.2); opacity: 0; }
    }

    .spell.monster {
        background: radial-gradient(circle, #66ccff, #0066ff);
        box-shadow: 0 0 25px #33aaff;
    }

    .blast {
        position: absolute;
        width: 150px;
        height: 150px;
        background: url('https://i.imgur.com/uP0R0yG.png') center/cover;
        animation: blastAnim 0.6s forwards;
        pointer-events: none;
    }

    @keyframes blastAnim {
        from { transform: scale(0.3); opacity: 1; }
        to { transform: scale(1.5); opacity: 0; }
    }

    .explode {
        position: absolute;
        width: 200px;
        height: 200px;
        background: url('https://i.imgur.com/EYlS7rG.png') center/cover;
        animation: explodeAnim 0.8s forwards;
    }

    @keyframes explodeAnim {
        from { opacity: 1; transform: scale(0.8); }
        to { opacity: 0; transform: scale(1.6); }
    }

    #hero.hit {
        animation: flashRed 0.4s;
    }

    @keyframes flashRed {
        0% { filter: brightness(1); }
        50% { filter: brightness(3) saturate(2); }
        100% { filter: brightness(1); }
    }
</style>
</head>

<body>

<h1>‚öîÔ∏è Multiplication RPG: Arcane Tower ‚öîÔ∏è</h1>

<!-- === RANK BAR UI === -->
<div id="rank-panel">
    <div id="rank-bar-container">
        <div id="rank-fill"></div>
    </div>

    <div id="rank-labels">
        <div>Grandmaster ‚ú®</div>
        <div>Archmage üîÆ</div>
        <div>Mage ‚ö°</div>
        <div>Adept üìò</div>
        <div>Apprentice üåÄ</div>
        <div>Novice ‚öîÔ∏è</div>
    </div>
</div>

<div id="battlefield">
    <div id="hero" class="character"></div>
    <div id="monster" class="character"></div>
</div>

<div id="hp-bars">
    Hero HP
    <div class="hp-bar"><div id="hero-hp" class="hp-fill"></div></div>

    Monster HP
    <div class="hp-bar"><div id="monster-hp" class="hp-fill"></div></div>
</div>

<div id="streak-indicator">Streak: 0</div>

<div id="question-box"></div>

<input type="number" id="answer" placeholder="Press ENTER">

<div id="log"></div>

<div id="results"></div>

<script>
let questions = [];
let current = 0;
let score = 0;

let streak = 0;
let monstersDefeated = 0;

let heroHP = 100;
let monsterHP = 60;

// === Generate 30 questions ===
for (let i = 0; i < 30; i++) {
    let a = Math.ceil(Math.random() * 11);
    let b = Math.ceil(Math.random() * 11);
    questions.push({ a, b });
}

function updateRankBar() {
    let progress = (score / 30) * 100;
    document.getElementById("rank-fill").style.height = progress + "%";
}

function showQuestion() {
    if (current >= questions.length || heroHP <= 0) {
        endGame();
        return;
    }

    let q = questions[current];
    document.getElementById("question-box").innerHTML =
        `Question ${current + 1}/30:<br>${q.a} √ó ${q.b} = ?`;
}

// === Magic projectile ===
function castSpell(fromId, toId, isMonster = false) {
    let from = document.getElementById(fromId);
    let to = document.getElementById(toId);

    let rect1 = from.getBoundingClientRect();
    let rect2 = to.getBoundingClientRect();

    let spell = document.createElement("div");
    spell.className = "spell";
    if (isMonster) spell.classList.add("monster");

    spell.style.left = (rect1.left + rect1.width/2 - 20) + "px";
    spell.style.top = (rect1.top + rect1.height/2 - 20) + "px";

    let dx = (rect2.left + rect2.width/2) - (rect1.left + rect1.width/2);
    let dy = (rect2.top + rect2.height/2) - (rect1.top + rect1.height/2);

    spell.animate(
        [
            { transform: `translate(0px,0px)` },
            { transform: `translate(${dx}px, ${dy}px)` }
        ],
        { duration: 500, easing: "linear" }
    );

    document.body.appendChild(spell);
    setTimeout(() => spell.remove(), 500);
}

function magicBlast(targetId) {
    let target = document.getElementById(targetId);
    let blast = document.createElement("div");
    blast.className = "blast";

    let rect = target.getBoundingClientRect();
    blast.style.left = (rect.left + rect.width/2 - 75) + "px";
    blast.style.top = (rect.top + rect.height/2 - 75) + "px";

    document.body.appendChild(blast);
    setTimeout(() => blast.remove(), 600);
}

function explodeMonster() {
    let target = document.getElementById("monster");
    let boom = document.createElement("div");
    boom.className = "explode";

    let rect = target.getBoundingClientRect();
    boom.style.left = (rect.left + rect.width/2 - 100) + "px";
    boom.style.top = (rect.top + rect.height/2 - 100) + "px";

    document.body.appendChild(boom);
    setTimeout(() => boom.remove(), 800);
}

function spawnMonster() {
    monsterHP = 60;
    document.getElementById("monster-hp").style.width = "100%";
    let mon = document.getElementById("monster");
    mon.style.opacity = 1;
    mon.style.transform = "scale(1)";
}

function submitAnswer() {
    let input = document.getElementById("answer");
    let userAnswer = Number(input.value);
    let q = questions[current];
    let correct = q.a * q.b;

    if (userAnswer === correct) {
        score++;
        streak++;

        // Update rank bar
        updateRankBar();

        let dmg = 10 + (streak * 5);
        if (dmg > 25) dmg = 25;

        monsterHP -= dmg;

        castSpell("hero", "monster");
        magicBlast("monster");

        document.getElementById("log").innerHTML =
            `‚ú® Correct! You dealt <strong>${dmg}</strong> damage!`;

        if (monsterHP <= 0) {
            monstersDefeated++;
            explodeMonster();

            document.getElementById("log").innerHTML +=
                `<br>üí• You defeated the monster!`;

            setTimeout(spawnMonster, 600);
        }

    } else {
        castSpell("monster", "hero", true);
        streak = 0;
        heroHP -= 10;

        document.getElementById("hero").classList.add("hit");
        setTimeout(() => document.getElementById("hero").classList.remove("hit"), 400);

        document.getElementById("log").innerHTML =
            `‚ùå Wrong! Correct: <strong>${correct}</strong>. Monster hits you!`;
    }

    document.getElementById("streak-indicator").innerHTML = `Streak: ${streak}`;
    document.getElementById("streak-indicator").style.transform = "scale(1.3)";
    setTimeout(() => {
        document.getElementById("streak-indicator").style.transform = "scale(1)";
    }, 150);

    document.getElementById("hero-hp").style.width = heroHP + "%";
    document.getElementById("monster-hp").style.width = monsterHP + "%";

    input.value = "";
    current++;
    showQuestion();
}

document.getElementById("answer").addEventListener("keydown", function(e) {
    if (e.key === "Enter") submitAnswer();
});

function endGame() {
    let finalMsg = `
        <p>You Defeated <strong>${monstersDefeated}</strong> monsters!</p>
        <p>Your Score: <strong>${score}/30</strong></p>
    `;

    if (score === 30) {
        finalMsg += `<p>üåü PERFECT! You reached <strong>GRANDMASTER</strong> rank! üåü</p>`;
    }

    document.getElementById("results").innerHTML = finalMsg +
        `<button onclick="location.reload()">Play Again</button>`;
}

showQuestion();
updateRankBar();
</script>

</body>
</html>
