<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Multiplication RPG Battle</title>
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: "Georgia", serif;
        background: linear-gradient(120deg, #2c0f41, #14001f);
        color: #f8e7ff;
        text-align: center;
    }

    h1 {
        font-size: 42px;
        margin-top: 20px;
        color: #e6c3ff;
        text-shadow: 0 0 10px #ff8df7;
    }

    #game-container {
        width: 90%;
        margin: auto;
        margin-top: 20px;
    }

    #battlefield {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin-top: 40px;
    }

    .character {
        width: 200px;
        height: 200px;
        background-size: cover;
        background-position: center;
    }

    #hero {
        background-image: url('https://i.imgur.com/0ZbmO2s.png'); /* cartoon knight */
    }

    #monster {
        background-image: url('https://i.imgur.com/8uOZ4Cp.png'); /* cartoon slime monster */
    }

    #hp-bars {
        margin-top: 20px;
        font-size: 24px;
    }

    .hp-bar {
        height: 25px;
        width: 60%;
        background: #3a003a;
        border: 2px solid #ffb7ff;
        margin: 10px auto;
        position: relative;
    }

    .hp-fill {
        background: #ff55ff;
        height: 100%;
        width: 100%;
        transition: width 0.5s;
    }

    #question-box {
        margin-top: 30px;
        font-size: 32px;
        font-weight: bold;
    }

    input {
        margin-top: 15px;
        font-size: 26px;
        padding: 8px;
        width: 150px;
        text-align: center;
        border-radius: 10px;
        border: none;
    }

    #log {
        margin-top: 20px;
        font-size: 20px;
        min-height: 50px;
    }

    #results {
        margin-top: 40px;
        font-size: 26px;
        font-weight: bold;
    }

    button {
        margin-top: 20px;
        font-size: 26px;
        padding: 12px 25px;
        border: none;
        border-radius: 10px;
        background: #b300ff;
        color: white;
        cursor: pointer;
        transition: 0.3s;
    }
    button:hover {
        background: #ff28ff;
    }

    /* Attack animation */
    .slash {
        position: absolute;
        width: 120px;
        height: 120px;
        background: url('https://i.imgur.com/2nKSLpV.png') center/cover;
        animation: slashAnim 0.5s forwards;
        pointer-events: none;
    }

    @keyframes slashAnim {
        from { transform: scale(0.2) rotate(0deg); opacity: 1; }
        to { transform: scale(1.4) rotate(180deg); opacity: 0; }
    }
</style>
</head>

<body>

<h1>‚öîÔ∏è Multiplication RPG: Battle of the Arcane Tower ‚öîÔ∏è</h1>

<div id="game-container">
    <div id="battlefield">
        <div id="hero" class="character"></div>
        <div id="monster" class="character"></div>
    </div>

    <div id="hp-bars">
        Hero HP
        <div class="hp-bar"><div id="hero-hp" class="hp-fill"></div></div>
        Monster HP
        <div class="hp-bar"><div id="monster-hp" class="hp-fill"></div></div>
    </div>

    <div id="question-box"></div>

    <input type="number" id="answer" placeholder="Type answer & press ENTER">

    <div id="log"></div>

    <div id="results"></div>
</div>

<script>
let questions = [];
let current = 0;
let score = 0;

let heroHP = 100;
let monsterHP = 100;

// Generate 30 questions
function generateQuestions() {
    for (let i = 0; i < 30; i++) {
        let a = Math.ceil(Math.random() * 11);
        let b = Math.ceil(Math.random() * 11);
        questions.push({ a, b });
    }
}

function showQuestion() {
    if (current >= questions.length || heroHP <= 0) {
        endGame();
        return;
    }
    let q = questions[current];
    document.getElementById("question-box").innerHTML =
        `Question ${current + 1}/30:<br> <span>${q.a} √ó ${q.b} = ?</span>`;
}

function animateSlash(targetId) {
    let target = document.getElementById(targetId);
    let slash = document.createElement("div");
    slash.className = "slash";
    let rect = target.getBoundingClientRect();
    slash.style.left = (rect.left + rect.width/2 - 60) + "px";
    slash.style.top = (rect.top + rect.height/2 - 60) + "px";
    document.body.appendChild(slash);
    setTimeout(() => slash.remove(), 500);
}

function submitAnswer() {
    let input = document.getElementById("answer");
    let userAnswer = Number(input.value);
    let q = questions[current];
    let correct = q.a * q.b;

    if (userAnswer === correct) {
        score++;
        monsterHP -= 10;
        animateSlash("monster");
        document.getElementById("log").innerHTML =
            `‚ú®Correct! You dealt 10 damage!`;
    } else {
        heroHP -= 10;
        animateSlash("hero");
        document.getElementById("log").innerHTML =
            `‚ùå Wrong! Correct answer: ${correct}. The monster hits you!`;
    }

    document.getElementById("hero-hp").style.width = heroHP + "%";
    document.getElementById("monster-hp").style.width = monsterHP + "%";

    input.value = "";
    current++;
    showQuestion();
}

// Allow ENTER key to submit
document.getElementById("answer").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
        submitAnswer();
    }
});

// RPG ranking
function getRank(score) {
    if (score === 30) return "üëë Archmage of Multiplication";
    if (score >= 25) return "üî• Dragon Knight";
    if (score >= 20) return "‚öîÔ∏è Rune Warrior";
    if (score >= 15) return "üõ°Ô∏è Apprentice Fighter";
    return "üå± Novice Adventurer";
}

function endGame() {
    // Update lifetime average
    let avg = Number(localStorage.getItem("avgScore")) || 0;
    let attempts = Number(localStorage.getItem("attempts")) || 0;
    let newAvg = ((avg * attempts) + score) / (attempts + 1);

    localStorage.setItem("avgScore", newAvg);
    localStorage.setItem("attempts", attempts + 1);

    let rank = getRank(score);

    document.getElementById("results").innerHTML = `
        <p>Battle Finished!</p>
        <p>Your Score: <strong>${score}/30</strong></p>
        <p>Your Rank: <strong>${rank}</strong></p>
        <p>Your Lifetime Average: <strong>${newAvg.toFixed(2)}</strong></p>
        <button onclick="location.reload()">Play Again</button>
    `;
}

generateQuestions();
showQuestion();
</script>

</body>
</html>
